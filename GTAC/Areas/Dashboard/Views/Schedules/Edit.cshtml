@model GTAC.Models.Schedule

@{
    ViewData["Title"] = "Schedule";
    bool isAdmin = User.IsInRole("Admin") || User.IsInRole("Manager") || User.IsInRole("Staff");
    bool isEdit = Model.Status == Status.Pending || Model.Status == Status.Reject || isAdmin;
    string formAction = isEdit ? "Edit" : "AddChangeRequest";
    bool is1Disabled = Model.DayOne < DateTime.Now;
    bool is2Disabled = Model.DayTwo < DateTime.Now;
    bool is3Disabled = Model.DayThree < DateTime.Now;
    bool is4Disabled = Model.DayFour < DateTime.Now;
    ViewData["NavSchedules"] = "active";
}

<style>
    .day.disabled {
        background: #d7bfbf !important;
    }

    option:disabled {
        color: #d7bfbf !important;
    }
</style>
<div class="row">
    <div class="col-lg-5">
        <div class="card shadow mb-4">
            <div class="card-header py-3">

                @if (Model.Status == Status.Pending || isAdmin)
                {
                    <h6 class="m-0 font-weight-bold text-primary">
                        Edit Schedule
                    </h6>
                }
                else
                {
                    <h6 class="m-0 font-weight-bold text-primary">
                        Request Schedule Change
                    </h6>
                }

            </div>
            <div class="card-body">
                @if (isAdmin)
                {
                    <form asp-action="@formAction">
                        <div asp-validation-summary="ModelOnly" class="text-danger"></div>
                        <input type="text" asp-for="DayOne" style="opacity:0; position:absolute" />
                        <input type="text" asp-for="DayTwo" style="opacity:0; position:absolute" />
                        <input type="text" asp-for="DayThree" style="opacity:0; position:absolute" />
                        <input type="text" asp-for="DayFour" style="opacity:0; position:absolute" />
                        <input type="hidden" asp-for="Id" />
                        <input type="hidden" asp-for="ApprovedAt" />
                        <input type="hidden" asp-for="DayFour" />
                        <input type="hidden" asp-for="StudentId" />

                        <div class="row">
                            <div class="form-group col-md-6">
                                <label class="control-label">Day 1</label>
                                <div class="input-group date" id="datepicker1" data-target-input="nearest">
                                    <input onkeypress="return false;" type="text" @(is1Disabled ? "disabled" : null) class="form-control datetimepicker-input datetimepicker-input1" data-target="#datepicker1" />
                                    <div class="input-group-append" data-target="#datepicker1" data-toggle="datetimepicker">
                                        <div class="input-group-text" style="background:white"><i class="fa fa-calendar"></i></div>
                                    </div>
                                </div>
                                <span asp-validation-for="DayOne" class="text-danger"></span>
                            </div>
                            <div class="form-group col-md-6">
                                <label class="control-label">Time Schedule</label>
                                <select class="form-control" id="timepicker1" @(is1Disabled ? "disabled" : null)>
                                    <option value="">Please Select Time</option>
                                    <option value="7:30 AM">7:30am to 9:30am</option>
                                    <option value="10:00 AM">10:00am to 12:00nn</option>
                                    <option value="1:00 PM">1:00pm to 3:00pm</option>
                                    <option value="3:00 PM">3:00pm to 5:00pm</option>
                                </select>
                            </div>
                        </div>
                        <div class="row">
                            <div class="form-group col-md-6">
                                <label class="control-label">Day 2</label>
                                <div class="input-group date" id="datepicker2" data-target-input="nearest">
                                    <input onkeypress="return false;" @(is2Disabled ? "disabled" : null) value="" type="text" class="form-control datetimepicker-input datetimepicker-input2" data-target="#datepicker2" />
                                    <div class="input-group-append" data-target="#datepicker2" data-toggle="datetimepicker">
                                        <div class="input-group-text" style="background:white"><i class="fa fa-calendar"></i></div>
                                    </div>
                                </div>
                                <span asp-validation-for="DayTwo" class="text-danger"></span>
                            </div>
                            <div class="form-group col-md-6">
                                <label class="control-label">Time Schedule</label>
                                <select class="form-control" id="timepicker2" @(is2Disabled ? "disabled" : null)>
                                    <option value="">Please Select Time</option>
                                    <option value="7:30 AM">7:30am to 9:30am</option>
                                    <option value="10:00 AM">10:00am to 12:00nn</option>
                                    <option value="1:00 PM">1:00pm to 3:00pm</option>
                                    <option value="3:00 PM">3:00pm to 5:00pm</option>
                                </select>
                            </div>
                        </div>
                        <div class="row">
                            <div class="form-group col-md-6">
                                <label class="control-label">Day 3</label>
                                <div class="input-group date" id="datepicker3" data-target-input="nearest">
                                    <input onkeypress="return false;" @(is3Disabled ? "disabled" : null) type="text" class="form-control datetimepicker-input datetimepicker-input3" data-target="#datepicker3" />
                                    <div class="input-group-append" data-target="#datepicker3" data-toggle="datetimepicker">
                                        <div class="input-group-text" style="background:white"><i class="fa fa-calendar"></i></div>
                                    </div>
                                </div>
                                <span asp-validation-for="DayThree" class="text-danger"></span>
                            </div>
                            <div class="form-group col-md-6">
                                <label class="control-label">Time Schedule</label>
                                <select class="form-control" id="timepicker3" @(is3Disabled ? "disabled" : null)>
                                    <option value="">Please Select Time</option>
                                    <option value="7:30 AM">7:30am to 9:30am</option>
                                    <option value="10:00 AM">10:00am to 12:00nn</option>
                                    <option value="1:00 PM">1:00pm to 3:00pm</option>
                                    <option value="3:00 PM">3:00pm to 5:00pm</option>
                                </select>
                            </div>
                        </div>
                        <div class="row">
                            <div class="form-group col-md-6">
                                <label class="control-label">Day 4</label>
                                <div class="input-group date" id="datepicker4" data-target-input="nearest">
                                    <input onkeypress="return false;" @(is4Disabled ? "disabled" : null) type="text" class="form-control datetimepicker-input datetimepicker-input4" data-target="#datepicker4" />
                                    <div class="input-group-append" data-target="#datepicker4" data-toggle="datetimepicker">
                                        <div class="input-group-text" style="background:white"><i class="fa fa-calendar"></i></div>
                                    </div>
                                </div>
                                <span asp-validation-for="DayFour" class="text-danger"></span>
                            </div>
                            <div class="form-group col-md-6">
                                <label class="control-label">Time Schedule</label>
                                <select class="form-control" id="timepicker4" @(is4Disabled ? "disabled" : null)>
                                    <option value="">Please Select Time</option>
                                    <option value="7:30 AM">7:30am to 9:30am</option>
                                    <option value="10:00 AM">10:00am to 12:00nn</option>
                                    <option value="1:00 PM">1:00pm to 3:00pm</option>
                                    <option value="3:00 PM">3:00pm to 5:00pm</option>
                                </select>
                            </div>
                        </div>
                        <div class="row">
                            <div class="form-group col-md-5">
                                <label asp-for="Status" class="control-label"></label>
                                <select asp-for="Status" class="form-control" asp-items="@Html.GetEnumSelectList<Status>()"></select>
                                <span asp-validation-for="Status" class="text-danger"></span>
                            </div>

                            <div class="form-group col-md-12">
                                @if (isEdit)
                                {
                                    <input type="submit" value="Save" class="btn btn-primary" />
                                }
                                else
                                {
                                    <input type="submit" value="Send Request" class="btn btn-primary" />
                                }
                                |
                                <a asp-action="Index">Back to List</a>
                            </div>
                        </div>

                    </form>
                }
                else
                {
                    <form asp-action="@formAction">
                        <div asp-validation-summary="ModelOnly" class="text-danger"></div>
                        <input type="text" asp-for="DayOne" style="opacity:0; position:absolute" />
                        <input type="text" asp-for="DayTwo" style="opacity:0; position:absolute" />
                        <input type="text" asp-for="DayThree" style="opacity:0; position:absolute" />
                        <input type="text" asp-for="DayFour" style="opacity:0; position:absolute" />
                        <input type="hidden" asp-for="Id" />
                        <input type="hidden" asp-for="ApprovedAt" />
                        <input type="hidden" asp-for="DayFour" />
                        <input type="hidden" asp-for="StudentId" />

                        <div class="row">
                            <div class="form-group col-md-6">
                                <label class="control-label">Day 1</label>
                                <div class="input-group date" id="datepicker1" data-target-input="nearest">
                                    <input onkeypress="return false;" type="text" @(is1Disabled ? "disabled" : null) class="form-control datetimepicker-input datetimepicker-input1" data-target="#datepicker1" />
                                    <div class="input-group-append" data-target="#datepicker1" data-toggle="datetimepicker">
                                        <div class="input-group-text" style="background:white"><i class="fa fa-calendar"></i></div>
                                    </div>
                                </div>
                                <span asp-validation-for="DayOne" class="text-danger"></span>
                            </div>
                            <div class="form-group col-md-6">
                                <label class="control-label">Time Schedule</label>
                                <select class="form-control" disabled id="timepicker1" @(is1Disabled ? "disabled" : null)>
                                    <option value="">Please Select Time</option>
                                    <option value="7:30 AM">7:30am to 9:30am</option>
                                    <option value="10:00 AM">10:00am to 12:00nn</option>
                                    <option value="1:00 PM">1:00pm to 3:00pm</option>
                                    <option value="3:00 PM">3:00pm to 5:00pm</option>
                                </select>
                            </div>
                        </div>
                        <div class="row">
                            <div class="form-group col-md-6">
                                <label class="control-label">Day 2</label>
                                <div class="input-group date" id="datepicker2" data-target-input="nearest">
                                    <input onkeypress="return false;" disabled @(is2Disabled ? "disabled" : null) type="text" class="form-control datetimepicker-input datetimepicker-input2" data-target="#datepicker2" />
                                    <div class="input-group-append" data-target="#datepicker2" data-toggle="datetimepicker">
                                        <div class="input-group-text" style="background:white"><i class="fa fa-calendar"></i></div>
                                    </div>
                                </div>
                                <span asp-validation-for="DayTwo" class="text-danger"></span>
                            </div>
                            <div class="form-group col-md-6">
                                <label class="control-label">Time Schedule</label>
                                <select class="form-control" disabled id="timepicker2" @(is2Disabled ? "disabled" : null)>
                                    <option value="">Please Select Time</option>
                                    <option value="7:30 AM">7:30am to 9:30am</option>
                                    <option value="10:00 AM">10:00am to 12:00nn</option>
                                    <option value="1:00 PM">1:00pm to 3:00pm</option>
                                    <option value="3:00 PM">3:00pm to 5:00pm</option>
                                </select>
                            </div>
                        </div>
                        <div class="row">
                            <div class="form-group col-md-6">
                                <label class="control-label">Day 3</label>
                                <div class="input-group date" id="datepicker3" data-target-input="nearest">
                                    <input onkeypress="return false;" disabled @(is3Disabled ? "disabled" : null) type="text" class="form-control datetimepicker-input datetimepicker-input3" data-target="#datepicker3" />
                                    <div class="input-group-append" data-target="#datepicker3" data-toggle="datetimepicker">
                                        <div class="input-group-text" style="background:white"><i class="fa fa-calendar"></i></div>
                                    </div>
                                </div>
                                <span asp-validation-for="DayThree" class="text-danger"></span>
                            </div>
                            <div class="form-group col-md-6">
                                <label class="control-label">Time Schedule</label>
                                <select class="form-control" disabled id="timepicker3" @(is3Disabled ? "disabled" : null)>
                                    <option value="">Please Select Time</option>
                                    <option value="7:30 AM">7:30am to 9:30am</option>
                                    <option value="10:00 AM">10:00am to 12:00nn</option>
                                    <option value="1:00 PM">1:00pm to 3:00pm</option>
                                    <option value="3:00 PM">3:00pm to 5:00pm</option>
                                </select>
                            </div>
                        </div>
                        <div class="row">
                            <div class="form-group col-md-6">
                                <label class="control-label">Day 4</label>
                                <div class="input-group date" id="datepicker4" data-target-input="nearest">
                                    <input onkeypress="return false;" disabled @(is4Disabled ? "disabled" : null) type="text" class="form-control datetimepicker-input datetimepicker-input4" data-target="#datepicker4" />
                                    <div class="input-group-append" data-target="#datepicker4" data-toggle="datetimepicker">
                                        <div class="input-group-text" style="background:white"><i class="fa fa-calendar"></i></div>
                                    </div>
                                </div>
                                <span asp-validation-for="DayFour" class="text-danger"></span>
                            </div>
                            <div class="form-group col-md-6">
                                <label class="control-label">Time Schedule</label>
                                <select class="form-control" disabled id="timepicker4" @(is4Disabled ? "disabled" : null)>
                                    <option value="">Please Select Time</option>
                                    <option value="7:30 AM">7:30am to 9:30am</option>
                                    <option value="10:00 AM">10:00am to 12:00nn</option>
                                    <option value="1:00 PM">1:00pm to 3:00pm</option>
                                    <option value="3:00 PM">3:00pm to 5:00pm</option>
                                </select>
                            </div>
                        </div>
                        <div class="row">

                            <input type="hidden" asp-for="Status" />
                            <div class="form-group col-md-12">
                                @if (isEdit)
                                {
                                    <input type="submit" value="Save" class="btn btn-primary" />
                                }
                                else
                                {
                                    <input type="submit" value="Send Request" class="btn btn-primary" />
                                }
                                |
                                <a asp-action="Index">Back to List</a>
                            </div>
                        </div>

                    </form>
                }

            </div>
        </div>
    </div>

</div>

@section Scripts {
    @{await Html.RenderPartialAsync("_ValidationScriptsPartial");}

    @if (isAdmin)
    {
        <script>
            $('#datepicker1').datetimepicker({
                format: 'L',
                date: '@Model.DayOne.ToString("MM/dd/yyyy")',
                daysOfWeekDisabled: [0, 6]
            });
            $('#datepicker2').datetimepicker({
                format: 'L',
                date: '@Model.DayTwo.ToString("MM/dd/yyyy")',
                daysOfWeekDisabled: [0, 6]
            });
            $('#datepicker3').datetimepicker({
                format: 'L',
                date: '@Model.DayThree.ToString("MM/dd/yyyy")',
                daysOfWeekDisabled: [0, 6]
            });
            $('#datepicker4').datetimepicker({
                format: 'L',
                date: '@Model.DayFour.ToString("MM/dd/yyyy")',
                daysOfWeekDisabled: [0, 6]
            });

            $("#timepicker1").val('@Model.DayOne.ToString("h:mm tt")');
            $("#timepicker2").val('@Model.DayTwo.ToString("h:mm tt")');
            $("#timepicker3").val('@Model.DayThree.ToString("h:mm tt")');
            $("#timepicker4").val('@Model.DayFour.ToString("h:mm tt")');

            $("#datepicker1").on("change.datetimepicker", function (e) {
                if ($("#timepicker1").val()) {
                    let date_converted = moment(e.date).format('L');
                    $('#DayOne').attr('value', date_converted + " " + $("#timepicker1").val()).blur();
                }
            });
            $("#datepicker2").on("change.datetimepicker", function (e) {
                if ($("#timepicker2").val()) {
                    let date_converted = moment(e.date).format('L');
                    $('#DayTwo').attr('value', date_converted + " " + $("#timepicker2").val()).blur();
                }
            });
            $("#datepicker3").on("change.datetimepicker", function (e) {
                if ($("#timepicker3").val()) {
                    let date_converted = moment(e.date).format('L');
                    $('#DayThree').attr('value', date_converted + " " + $("#timepicker3").val()).blur();
                }
            });
            $("#datepicker4").on("change.datetimepicker", function (e) {
                if ($("#timepicker4").val()) {
                    $('#DayFour').attr('value', date_converted + " " + $("#timepicker4").val()).blur();
                }
            });

            $("#timepicker1").on("change", function (e) {
                if ($(".datetimepicker-input1").val() && $(this).val()) {
                    $('#DayOne').attr('value', $(".datetimepicker-input1").val() + " " + $(this).val()).blur();
                }
                else {
                    $('#DayOne').attr('value', '').blur();
                }
            });
            $("#timepicker2").on("change", function (e) {
                if ($(".datetimepicker-input2").val() && $(this).val()) {
                    $('#DayTwo').attr('value', $(".datetimepicker-input2").val() + " " + $(this).val()).blur();
                } else {
                    $('#DayTwo').attr('value', '').blur();
                }
            });
            $("#timepicker3").on("change", function (e) {
                if ($(".datetimepicker-input3").val() && $(this).val()) {
                    $('#DayThree').attr('value', $(".datetimepicker-input3").val() + " " + $(this).val()).blur();
                } else {
                    $('#DayThree').attr('value', '').blur();
                }
            });
            $("#timepicker4").on("change", function (e) {
                if ($(".datetimepicker-input4").val() && $(this).val()) {
                    $('#DayFour').attr('value', $(".datetimepicker-input4").val() + " " + $(this).val()).blur();
                } else {
                    $('#DayFour').attr('value', '').blur();
                }
            });
        </script>
    }
    else
    {
        <script>

            var datesOccupied = [];

            $.ajax({
                url: "/Dashboard/Schedules/GetDisabledDates",
                data: {id:"@Model.Id", studentId: "@Model.StudentId"},
                type: "get",
                success: function (res) {
                    datesOccupied = res.dates
                    let options = {
                        useCurrent: false,
                        format: 'L',
                        minDate: new Date(),
                        disabledDates: datesOccupied.filter(d => d.total > 3).map(d => d.date),
                        daysOfWeekDisabled: [0, 6]
                    }
                    initializeAllDataPickers(options)


                    $("#create_form").show()
                    $("#loader").addClass("d-none").removeClass("d-flex")
                },
                error: function (err) {
                    console.log(err)
                }
            });

            function initializeAllDataPickers(options) {
                @if (!is1Disabled)
                {
                    <text>
                        $('#datepicker1').datetimepicker(options);
                    </text>
                }
                else
                {
                    <text>
                        $('.datetimepicker-input1').val('@Model.DayOne.ToString("MM/dd/yyyy")');
                        $('.datetimepicker-input1').prop('disabled', true);
                        $("#timepicker1").prop('disabled', true);
                        $("#timepicker1").val('@Model.DayOne.ToString("h:mm tt")');
                        addToDates('@Model.DayOne.ToString("MM/dd/yyyy")')
                    </text>
                }
                @if (!is2Disabled)
                {
                    <text>
                        $('#datepicker2').datetimepicker(options);
                    </text>
                }
                else
                {
                    <text>
                        $('.datetimepicker-input2').val('@Model.DayTwo.ToString("MM/dd/yyyy")');
                        $('.datetimepicker-input2').prop('disabled', true);
                        $("#timepicker2").prop('disabled', true);
                        $("#timepicker2").val('@Model.DayTwo.ToString("h:mm tt")');
                        addToDates('@Model.DayTwo.ToString("MM/dd/yyyy")')
                    </text>
                }
                @if (!is3Disabled)
                {
                    <text>
                        $('#datepicker3').datetimepicker(options);
                    </text>
                }
                else
                {
                    <text>
                        $('.datetimepicker-input3').val('@Model.DayThree.ToString("MM/dd/yyyy")');
                        $('.datetimepicker-input3').prop('disabled', true);
                        $("#timepicker3").prop('disabled', true);
                        $("#timepicker3").val('@Model.DayThree.ToString("h:mm tt")');
                        addToDates('@Model.DayThree.ToString("MM/dd/yyyy")')
                    </text>
                }
                @if (!is4Disabled)
                {
                    <text>
                        $('#datepicker4').datetimepicker(options);
                    </text>
                }
                else
                {
                    <text>
                        $('.datetimepicker-input4').val('@Model.DayFour.ToString("MM/dd/yyyy")');
                        $('.datetimepicker-input4').prop('disabled', true);
                        $("#timepicker4").prop('disabled', true);
                        $("#timepicker4").val('@Model.DayFour.ToString("h:mm tt")');
                        addToDates('@Model.DayFour.ToString("MM/dd/yyyy")')
                    </text>
                }

                $('.datetimepicker-input').each(function (i) {
                    if (!$(this).val()) {
                        !$(this).prop('disabled', false);
                        return false;
                    }
                })

            }

            function addToDates(val_date) {
                let isAny = false;
                for (var i = 0; i < datesOccupied.length; i++) {
                    if (datesOccupied[i].date === val_date) {
                        datesOccupied[i].total++;
                        isAny = true;
                        break;
                    }
                }
                if (!isAny) {
                    let new_date = {};
                    new_date.date = val_date;
                    new_date.total = 1;
                    datesOccupied.push(new_date)
                }
                console.log(datesOccupied);
            }

            function subtractToDates(val_date) {
                for (var i = 0; i < datesOccupied.length; i++) {
                    if (datesOccupied[i].date === val_date) {
                        datesOccupied[i].total--;
                        isAny = true;
                        break;
                    }
                }
            }

            function initializeDatePicker(i, minDate) {
                //reinitialize datepicker
                $('.datetimepicker-input' + i).prop('disabled', false);
                $('#datepicker' + i).datetimepicker('minDate', minDate)
                $('#datepicker' + i).datetimepicker('disabledDates', datesOccupied.filter(d => d.total > 3).map(d => d.date))
            }

            function disableNextDateTimePickers(num) {
                for (var i = num + 1; i <= 4; i++) {
                    $('#datepicker' + i).datetimepicker('clear');
                    $('.datetimepicker-input' + i).prop('disabled', true);
                    $("#timepicker" + i).prop('disabled', true); //reset disabled select
                    $("#timepicker" + i).val('');
                }
            }

            $("#datepicker1").on("change.datetimepicker", function (e) {
                if (e.date && e.hasOwnProperty('oldDate')) {
                    $("#timepicker1").val('');
                    let date_converted = moment(e.date).format('L');

                    $("#timepicker1").find("option").prop('disabled', false); //reset disabled select
                    getDisabledTimes(date_converted, "#timepicker1")

                    addToDates(date_converted);
                }

                if (e.oldDate) { //if previous date exist subtract to dates
                    subtractToDates(moment(e.oldDate).format('L'))
                }
                disableNextDateTimePickers(1)
            });
            $("#datepicker2").on("change.datetimepicker", function (e) {
                if (e.date && e.hasOwnProperty('oldDate')) {
                    $("#timepicker2").val('');
                    let date_converted = moment(e.date).format('L');

                    $("#timepicker2").find("option").prop('disabled', false); //reset disabled select
                    if (date_converted == $('.datetimepicker-input1').val()) { //check if has the same value
                        let selector = `option[value='${$("#timepicker1").val()}']`;
                        $("#timepicker2").find(selector).prop('disabled', true);
                    }

                    getDisabledTimes(date_converted, "#timepicker2")

                    addToDates(date_converted)
                }

                if (e.oldDate) { //if previous date exist subtract to dates
                    subtractToDates(moment(e.oldDate).format('L'))
                }
                disableNextDateTimePickers(2)
            });
            $("#datepicker3").on("change.datetimepicker", function (e) {
                if (e.date && e.hasOwnProperty('oldDate')) {
                    $("#timepicker3").val('');
                    let date_converted = moment(e.date).format('L');

                    $("#timepicker3").find("option").prop('disabled', false); //reset disabled select

                    for (var i = 2; i >= 1; i--) { //check if has the same value before
                        if ($('.datetimepicker-input' + i).val() == date_converted) {
                            let time = $("#timepicker" + i).val()
                            let selector = `option[value='${time}']`;
                            $("#timepicker3").find(selector).prop('disabled', true);
                        }
                    }

                    getDisabledTimes(date_converted, "#timepicker3")

                    addToDates(date_converted)
                }

                if (e.oldDate) { //if previous date exist subtract to dates
                    subtractToDates(moment(e.oldDate).format('L'))
                }
                disableNextDateTimePickers(3)
            });
            $("#datepicker4").on("change.datetimepicker", function (e) {
                if (e.date && e.hasOwnProperty('oldDate')) {
                    $("#timepicker4").val('');
                    let date_converted = moment(e.date).format('L');

                    $("#timepicker4").find("option").prop('disabled', false); //reset disabled select

                    for (var i = 3; i >= 1; i--) { //check if has the same value before
                        if ($('.datetimepicker-input' + i).val() == date_converted) {
                            let time = $("#timepicker" + i).val()
                            let selector = `option[value='${time}']`;
                            $("#timepicker4").find(selector).prop('disabled', true);
                        }
                    }

                    getDisabledTimes(date_converted, "#timepicker4")

                    addToDates(date_converted)
                }

                if (e.oldDate) { //if previous date exist subtract to dates
                    subtractToDates(moment(e.oldDate).format('L'))
                }
                disableNextDateTimePickers(4)
            });

            function getDisabledTimes(date, el) {
                return $.ajax({
                    url: "/Dashboard/Schedules/GetDisabledTime",
                    type: "get",
                    data: { date: date, id: '@Model.Id', studentId: '@Model.StudentId' },
                    success: function (res) {
                        $(el).prop('disabled', false);
                        let times = res.times;

                        for (var i = 0; i < times.length; i++) {
                            let selector = `option[value='${times[i]}']`;
                            $(el).find(selector).prop('disabled', true);
                        }
                    },
                    error: function (err) {
                        console.log(err)
                    }
                });
            }

            $("#timepicker1").on("change", function (e) {
                disableNextDateTimePickers(1) //disable next fields
                if ($(this).val()) {
                    initializeDatePicker(2, $(".datetimepicker-input1").val()) //initialize next DatePicker
                }

                if ($(".datetimepicker-input1").val() && $(this).val()) { // Set hidden field for Day1
                    $('#DayOne').attr('value', $(".datetimepicker-input1").val() + " " + $(this).val()).blur();
                }
                else {
                    $('#DayOne').attr('value', '').blur();
                }
            });
            $("#timepicker2").on("change", function (e) {
                disableNextDateTimePickers(2) //disable next fields
                if ($(this).val()) {
                    initializeDatePicker(3, $(".datetimepicker-input2").val()) //initialize next DatePicker
                }

                if ($(".datetimepicker-input2").val() && $(this).val()) { // Set hidden field for Day2
                    $('#DayTwo').attr('value', $(".datetimepicker-input2").val() + " " + $(this).val()).blur();
                }
                else {
                    $('#DayTwo').attr('value', '').blur();
                }
            });
            $("#timepicker3").on("change", function (e) {
                disableNextDateTimePickers(3) //disable next fields
                if ($(this).val()) {
                    initializeDatePicker(4, $(".datetimepicker-input3").val()) //initialize next DatePicker
                }

                if ($(".datetimepicker-input3").val() && $(this).val()) { // Set hidden field for Day3
                    $('#DayThree').attr('value', $(".datetimepicker-input3").val() + " " + $(this).val()).blur();
                }
                else {
                    $('#DayThree').attr('value', '').blur();
                }
            });
            $("#timepicker4").on("change", function (e) {
                if ($(".datetimepicker-input4").val() && $(this).val()) { // Set hidden field for Day4
                    $('#DayFour').attr('value', $(".datetimepicker-input4").val() + " " + $(this).val()).blur();
                }
                else {
                    $('#DayFour').attr('value', '').blur();
                }
            });

        </script>
    }
}