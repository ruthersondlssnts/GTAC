@model GTAC.Models.Student
@{
    ViewData["Title"] = "Students";
    ViewData["NavStudents"] = "active";
    var Sched = ViewBag.StudSched;
    var ChangeRequest = ViewBag.ChangeRequest;
}

<div class="row">
    <div class="col-lg-6">
        <div class="card shadow mb-4">
            <div class="card-header py-3">
                <h6 class="m-0 font-weight-bold text-primary">Student Details</h6>
            </div>
            <div class="card-body">
                <img id="preview" src="~/images/users/@(Model.User.PhotoPath ?? "img-prev.jpg" )" style="height:100px; width:100px; display:block" class="m-3 mx-auto rounded-circle" />

                <dl class="row">
                    <dt class="col-lg-4">
                        First Name
                    </dt>
                    <dd class="col-lg-8">
                        @Model.User.Firstname
                    </dd>
                    <dt class="col-lg-4">
                        Last Name
                    </dt>

                    <dd class="col-lg-8">
                        @Model.User.Lastname
                    </dd>
                    <dt class="col-lg-4">
                        Middle Name
                    </dt>
                    <dd class="col-lg-8">
                        @Model.User.Middlename
                    </dd>
                    <dt class="col-lg-4">
                        Suffix
                    </dt>
                    <dd class="col-lg-8">
                        @Model.User.Suffix
                    </dd>

                    <dt class="col-lg-4">
                        Phone
                    </dt>
                    <dd class="col-lg-8">
                        @Model.User.PhoneNumber
                    </dd>
                    <dt class="col-lg-4">
                        Birthday
                    </dt>
                    <dd class="col-lg-8">
                        @Model.User.Birthday
                    </dd>
                    <dt class="col-lg-4">
                        Address
                    </dt>
                    <dd class="col-lg-8">
                        @Model.User.Address
                    </dd>
                    <dt class="col-lg-4">
                        Email
                    </dt>
                    <dd class="col-lg-8">
                        @Model.User.Email
                    </dd>
                    <dt class="col-lg-4">
                        Instructor
                    </dt>
                    <dd class="col-lg-8">
                        @Model.Instructor.Firstname @Model.Instructor.Lastname
                    </dd>
                    <dt class="col-lg-4">
                        Enrolled At
                    </dt>
                    <dd class="col-lg-8">
                        @Model.EnrolledAt
                    </dd>
                    <dt class="col-lg-4">
                        Graduated At
                    </dt>
                    <dd class="col-lg-8">
                        @Model.GraduatedAt
                    </dd>

                </dl>
                <div>
                    <a asp-action="Index">Back to List</a>
                </div>

            </div>
        </div>
    </div>
    @if (ChangeRequest != null)
    {
        <div class="col-lg-6">
            <div class="card shadow mb-4">
                <div class="card-header py-3">
                    <h6 class="m-0 font-weight-bold text-primary">Student Change Profile Request</h6>
                </div>
                <div class="card-body">
                    <img id="preview" src="~/images/users/@(ChangeRequest.PhotoPath ?? ChangeRequest.User.PhotoPath ?? "img-prev.jpg")" style="height:100px; width:100px; display:block" class="m-3 mx-auto rounded-circle" />
                    <dl class="row mb-0">
                        <dt class="col-lg-4">
                            First Name
                        </dt>
                        <dd class="col-lg-8">
                            @ChangeRequest.Firstname
                        </dd>
                        <dt class="col-lg-4">
                            Last Name
                        </dt>
                        <dd class="col-lg-8">
                            @ChangeRequest.Lastname
                        </dd>
                        <dt class="col-lg-4">
                            Middle Name
                        </dt>
                        <dd class="col-lg-8">
                            @ChangeRequest.Middlename
                        </dd>
                        <dt class="col-lg-4">
                            Suffix
                        </dt>
                        <dd class="col-lg-8">
                            @ChangeRequest.Suffix
                        </dd>
                        <dt class="col-lg-4">
                            Phone
                        </dt>
                        <dd class="col-lg-8">
                            @ChangeRequest.PhoneNumber
                        </dd>
                        <dt class="col-lg-4">
                            Birthday
                        </dt>
                        <dd class="col-lg-8">
                            @ChangeRequest.Birthday
                        </dd>
                        <dt class="col-lg-4">
                            Address
                        </dt>
                        <dd class="col-lg-8">
                            @ChangeRequest.Address
                        </dd>
                        <dt class="col-lg-4">
                            Status
                        </dt>
                        <dd class="col-lg-8">
                            @ChangeRequest.Status
                        </dd>

                    </dl>
                    <form asp-action="EditStatusChangeRequest" asp-area="Dashboard" asp-controller="Students">
                        <input type="hidden" name="id" value="@ChangeRequest.Id" />
                        <select class="form-control col-lg-6 mb-3" name="status">
                            <option value="">Set Status</option>
                            <option value="1">Approved</option>
                            <option value="2">Reject</option>
                        </select>
                        <input type="submit" value="Save" class="btn btn-primary" />
                    </form>
                </div>
            </div>
        </div>
    }
    @if (Sched != null)
    {
        <div class="col-lg-6">
            <div class="card shadow mb-4">
                <div class="card-header py-3">
                    <h6 class="m-0 font-weight-bold text-primary">Student Schedule</h6>
                </div>
                <div class="card-body">
                    <dl class="row">
                        <dt class="col-lg-4">
                            Day 1  <br />
                            <small> Maneuvering</small>
                        </dt>
                        <dd class="col-lg-5">
                            @Sched.DayOne.ToString("dddd, MMM dd yyyy") <br />
                            <small>@Sched.DayOne.ToString("h:mm tt") - @Sched.DayOne.AddHours(2).ToString("h:mm tt")</small>
                        </dd>
                        @if (User.IsInRole("Instructor"))
                        {
                            <dd class="col-lg-3">
                                <select class="form-control select-assess1" onchange="handleSelectChange(this,'@Sched.Id', 1)">
                                    <option value="">Select Assessment </option>
                                    <option value="false">Fail</option>
                                    <option value="true">Pass</option>
                                </select>
                            </dd>
                        }

                        <dt class="col-lg-4">
                            Day 2 <br />
                            <small>Horizontal and Vertical Parking</small>
                        </dt>
                        <dd class="col-lg-5">
                            @Sched.DayTwo.ToString("dddd, MMM dd yyyy") <br />
                            <small>@Sched.DayTwo.ToString("h:mm tt") - @Sched.DayTwo.AddHours(2).ToString("h:mm tt")</small>
                        </dd>
                        @if (User.IsInRole("Instructor"))
                        {
                            <dd class="col-lg-3">
                                <select class="form-control select-assess2" onchange="handleSelectChange(this,'@Sched.Id', 2)">
                                    <option value="">Select Assessment </option>
                                    <option value="false">Fail</option>
                                    <option value="true">Pass</option>
                                </select>
                            </dd>
                        }

                        <dt class="col-lg-4">
                            Day 3 <br />
                            <small>Uphill/Downhill</small>
                        </dt>
                        <dd class="col-lg-5">
                            @Sched.DayThree.ToString("dddd, MMM dd yyyy") <br />
                            <small> @Sched.DayThree.ToString("h:mm tt") - @Sched.DayThree.AddHours(2).ToString("h:mm tt")</small>
                        </dd>
                        @if (User.IsInRole("Instructor"))
                        {
                            <dd class="col-lg-3">
                                <select class="form-control select-assess3" onchange="handleSelectChange(this,'@Sched.Id', 3)">
                                    <option value="">Select Assessment </option>
                                    <option value="false">Fail</option>
                                    <option value="true">Pass</option>
                                </select>
                            </dd>
                        }

                        <dt class="col-lg-4">
                            Day 4 <br />
                            <small>City/Driving</small>
                        </dt>

                        <dd class="col-lg-5">
                            @Sched.DayFour.ToString("dddd, MMM dd yyyy") <br />
                            <small> @Sched.DayFour.ToString("h:mm tt") - @Sched.DayFour.AddHours(2).ToString("h:mm tt")</small>
                        </dd>
                        @if (User.IsInRole("Instructor"))
                        {
                            <dd class="col-lg-3">
                                <select class="form-control select-assess4" onchange="handleSelectChange(this,'@Sched.Id', 4)">
                                    <option value="">Select Assessment </option>
                                    <option value="false">Fail</option>
                                    <option value="true">Pass</option>
                                </select>
                            </dd>
                        }


                    </dl>
                </div>
            </div>
        </div>
    }
</div>


@section Scripts {
    @if (Sched != null)
    {
        <script>

        $(".select-assess1").val('@Sched.isDayOnePassed'.toLowerCase());
        $(".select-assess2").val('@Sched.isDayTwoPassed'.toLowerCase());
        $(".select-assess3").val('@Sched.isDayThreePassed'.toLowerCase());
        $(".select-assess4").val('@Sched.isDayFourPassed'.toLowerCase());

        function handleSelectChange(opt, id, day) {
            $.ajax({
                url: "/Dashboard/Schedules/UpdateAssessment",
                data: { id, day, status: opt.value },
                type: "get",
                success: function (res) {
                },
                error: function (err) {
                    console.log(err)
                }
            });
        }
        </script>
    }

}

